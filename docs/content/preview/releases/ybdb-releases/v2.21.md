---
title: What's new in the v2.21 preview release series
headerTitle: What's new in the v2.21 preview release series
linkTitle: v2.21 series (Preview)
description: Enhancements, changes, and resolved issues in the v2.21 preview release series.
image: /images/section_icons/quick_start/install.png
aliases:
  - /preview/releases/release-notes/latest-release/
  - /preview/releases/whats-new/latest-release
menu:
  preview_releases:
    identifier: v2.21
    parent: ybdb-releases
    weight: 2810
type: docs
---

{{< tip title="YugabyteDB Anywhere release notes have moved" >}}
Starting with v2.16, the [release notes for YugabyteDB Anywhere](../../yba-releases/) have moved to [their own page](../../yba-releases/v2.21/).
{{< /tip >}}

What follows are the release notes for the YugabyteDB v2.21 release series. Content will be added as new notable features and changes are available in the patch releases of the YugabyteDB v2.21 release series.

For an RSS feed of all release series, point your feed reader to the [RSS feed for releases](../../index.xml).

## v2.21.0.0 - March 18, 2023 {#v2.21.0.0}

**Build:** `2.21.0.0-b152`

### Downloads

<ul class="nav yb-pills">
  <li>
    <a href="https://downloads.yugabyte.com/releases/2.21.0.0/yugabyte-2.21.0.0-b152-darwin-x86_64.tar.gz">
      <i class="fa-brands fa-apple"></i>
      <span>macOS</span>
    </a>
  </li>
  <li>
    <a href="https://downloads.yugabyte.com/releases/2.21.0.0/yugabyte-2.21.0.0-b152-linux-x86_64.tar.gz">
      <i class="fa-brands fa-linux"></i>
      <span>Linux x86</span>
    </a>
  </li>
  <li>
    <a href="https://downloads.yugabyte.com/releases/2.21.0.0/yugabyte-2.21.0.0-b152-el8-aarch64.tar.gz">
      <i class="fa-brands fa-linux"></i>
      <span>Linux ARM</span>
    </a>
  </li>
</ul>

**Docker:**

```sh
docker pull yugabytedb/yugabyte:2.21.0.0-b152
```

### Highlights

**PostgreSQL Emulation mode**

We're pleased to announce the tech preview of the new PostgreSQL emulation mode in the 2.21.0.0 release. This mode enables you to take advantage of many new improvements in both code compatibility and performance parity, thus making it even easier to lift and shift your applications from PostgreSQL to YugabyteDB. When this mode is turned on, YugabyteDB will use the [Read-Committed](../../../architecture/transactions/read-committed/) isolation mode, the [Wait-on-Conflict](../../../architecture/transactions/concurrency-control/#wait-on-conflict) concurrency mode for predictable P99 latencies, and the new Cost Based Optimizer that takes advantage of the distributed storage layer architecture and includes query pushdowns, LSM indexes, and [batched nested loop joins](../../../explore/ysql-language-features/join-strategies/#batched-nested-loop-join-bnl) to offer PostgreSQL like performance.

You can enable the emulation mode by passing the `enable_pg_parity_tech_preview` flag to [yugabyted](../../../reference/configuration/yugabyted/#yugabyted), when bringing up your cluster.

For example, from your YugabyteDB home directory, run the following command:

```sh
./bin/yugabyted start--enable_pg_parity_tech_preview
```

**New YugabyteDB Kubernetes Operator**

A preliminary version of the completely rewritten YugabyteDB Kubernetes Operator is available in [Tech Preview](/preview/releases/versioning/#feature-availability). The new operator automates the deployment, scaling, and management of YugabyteDB clusters in Kubernetes environments. It streamlines database operations, reducing manual effort for developers and operators.

For more information, refer to the [YugabyteDB Kubernetes Operator](https://github.com/yugabyte/yugabyte-k8s-operator) GitHub project.

**Changes in supported Operating Systems**

Please note that YugabyteDB 2.21.0.0 and newer releases do not support v7 Linux versions (CentOS7, RHEL7, Oracle Enterprise Linux 7.x), Amazon Linux 2, and Ubuntu 18. If you're currently using one of these Linux versions, please upgrade to a supported OS version before installing YugabyteDB 2.21.0.0 version. Refer to [Operating system support](../../../reference/configuration/operating-systems/), for the complete list of supported Operating Systems.

### New features

* [New Kubernetes Operator](https://github.com/yugabyte/yugabyte-k8s-operator). Automated deployment and management of  clusters via the Kubernetes operator pattern. Includes support for YugabyteDB universes as a Kubernetes custom resource. Backup, upgrade, scale-out, scale-in, and more are possible on this Kubernetes custom resource. {{<badge/tp>}}

* [Backup and restore support in yugabyted](../../../reference/configuration/yugabyted/). yugabyted CLI enabled support for taking database/keyspace backups. You now have the capability to upload backups to public clouds, including AWS and GCP. {{<badge/tp>}}

* DDL concurrency. Support for isolating DDLs per database. Specifically, a DDL in one database does not cause catalog cache refreshes or aborts transactions due to breaking change in another database. {{<badge/tp>}}

* YSQL: DDL atomicity. Ensures that YSQL DDLs are fully atomic between YSQL and DocDB layers, that is in case of any errors, they are fully rolled back, and in case of success they are applied fully. Currently, such inconsistencies are rare but can happen. {{<badge/tp>}}

* YSQL: Lower latency for large scans with size-based fetching. A static size based fetch limit value to control how many rows can be returned in one request from DocDB. {{<badge/tp>}}

* [YSQL: ALTER TABLE support](../../../api/ysql/the-sql-language/statements/ddl_alter_table/#add-column-if-not-exists-column-name-data-type-constraint-constraints). {{<badge/tp>}} Adds support for the following variants of ALTER TABLE ADD COLUMN:
  * with a SERIAL data type
  * with a volatile DEFAULT
  * with a PRIMARY KEY

### Change log

<details>
  <summary>View the detailed changelog</summary>

#### Improvements

##### YSQL

* Introduces yb_silence_advisory_locks_not_supported_error as a temporary solution, avoiding disruption while users transition from the use of advisory locks. {{<issue 19974>}}
* Shifts from the test gflag "FLAGS_TEST_enable_db_catalog_version_mode" to the {{<badge/tp>}} gflag "FLAGS_ysql_enable_db_catalog_version_mode", enhancing user control over concurrent DDL execution across different databases. {{<issue 12417>}}
* Issues a notice for unsafe ALTER TABLE operations, including for ADD COLUMN...DEFAULT, to indicate existing rows won't be backfilled with the default value, enhancing user awareness. Suppression possible by setting ysql_suppress_unsafe_alter_notice gflag to true. {{<issue 19360>}}
* Added sorting capabilities to BatchNestedLoopJoin to return the rows in the same order as NestedLoopJoin. {{<issue 19589>}}
* Replaces the `ysql_max_read_restart_attempts` and `ysql_max_write_restart_attempts` gflags with `yb_max_query_layer_retries`, applies limit to Read Committed isolation statement retries, and adjusts `retry_backoff_multiplier` and `retry_min_backoff` defaults. {{<issue 20359>}}
* Disallows the creation of a temporary index with a tablespace, preventing client hangs and providing a clear error message for temporary index creation with set tablespace. {{<issue 19368>}}
* Enables index tablespace modification through the `ALTER INDEX SET TABLESPACE` command and regulates column statistics using the `ALTER INDEX ALTER COLUMN SET STATISTICS` command. Also, allows the creation and alteration of materialized views with the specified tablespace. Suppress the beta feature warning by enabling `ysql_beta_feature_tablespace_alteration` flag. {{<issue 6639>}}
* Adds function to log the memory contexts of a specified backend process, enhancing memory usage monitoring and allowing users to troubleshoot memory-related issues more effectively. {{<issue 14025>}}

##### DocDB

* Allows customizing retryable request timeouts to respect client-side YCQL and YSQL timings, optimizing log replay and preventing the tserver from rejecting requests that exceed durations. Adjusts default retryable request timeout to 660 seconds and offers a configuration to eliminate server-side retention of retryable requests with `FLAGS_retryable_request_timeout_secs =0`. {{<issue 18736>}}
* Speeds up TServer Init by optimizing the handling of deleted and tombstoned tablets. It ensures faster startup by using a new flag `num_open_tablets_metadata_simultaneously`, which sets the number of threads for opening tablet metadata. This allows for parallel opening of metadata, improving response times even in cases with large numbers of tablets. Additionally, the handling of tablets marked as `Deleted` or `Tombstoned` is managed asynchronously, marking tombstoned tablets as dirty for inclusion in the next heartbeat. {{<issue 15088>}}
* Logs all instances of tablet metadata creation/updation, enabling additional insights for troubleshooting in cases of multiple meta records for the same tablet. {{<issue 20042>}}
* Adds a 10-second delay (`auto_flags_apply_delay_ms`) between AutoFlag config updates and their application, allowing all tservers to receive the new config before applying it. This change enhances configuration consistency and update safety. {{<issue 19932>}}
* Enhances thread safety by setting `Wthread-safety-reference` to check when guarded members are passed by reference and resolving all build errors resulting from this change. {{<issue 19365>}}
* Automates recovery of index tables impacted by a bug, preventing performance degradation and disk size leak, by ensuring schema.table_properties.retain_delete_markers is reset to false when index backfilling is done. {{<issue 19731>}}
* Enhances the `demote_single_auto_flag` yb-admin command by returning distinct error messages for invalid process_name, flag_name, or non-promoted flag, thereby aiding easier identification of errors. Replaces `HasSubstring` with `ASSERT_STR_CONTAINS` in the AutoFlags yb-admin test. {{<issue 20004>}}
* Introduces support for Upgrade and Downgrade of universes with xCluster links, enhancing compatibility checks for AutoFlags during these operations. Data replication between two universes is only catered if AutoFlags of the Target universe are compatible with the Source universe. The compatibility check, stored in `ProducerEntryPB`, triggers if the AutoFlag configuration changes during upgrades and rollbacks. This prevents unnecessary RPC calls if no AutoFlag configurations have changed. Also includes fixes for cds initialization bugs in `TestThreadHolder`. {{<issue 19518>}}
* Offers redesigned server level aggregation for metrics, thus introducing more metrics for enhanced debugging. Removes several unused URL parameters and makes the new output compatible with YBA and YBM, preventing double-counting issues in charts. Drops unused JSON and Prometheus callbacks from MetricEntity for a cleaner design. {{<issue 18078>}}
* Allows a limit on the addition of new tablet replicas in a cluster to conserve CPU resources, with safeguards for downscaling. Introduces test flags for controlling memory reservation and tablet replica per core limits. {{<issue 16177>}}
* Introduces verbose logging for global and per table state transitions in the load balancer to facilitate easier debugging. {{<issue 20289>}}
* Reduces server initialization time by eliminating the accumulation of deleted tablet superblocks during startup, through a modification in the `DeleteTablet` operation. {{<issue 19840>}}
* Enables automatic recovery of index tables affected by a bug, verifying their backfilling status and correcting the `retain_delete_markers` property to enhance performance. {{<issue 20247>}}
* Includes single shard (fast-path) transactions in the pg_locks by querying single shard waiters registered with the local waiting transaction registry at the corresponding Tserver, ensuring more complete transaction tracking and lock status reporting. {{<issue 18195>}}
* Creates Prometheus metrics for server hard and soft memory limits which allow detailed insight into TServer or master memory usage regardless of Google flag defaults; aids in creating dashboards charts to monitor utilization close to soft limit or TServer TCMalloc overhead. {{<issue 20578>}}
* Enables control over the batching of non-deferred indexes during backfill via a new flag, improving index management. {{<issue 20213>}}

#### Bug fixes

##### YSQL

* Introduces yb_silence_advisory_locks_not_supported_error as a temporary solution, avoiding disruption while users transition from the use of advisory locks. {{<issue 19974>}}
* Shifts from the test gflag "FLAGS_TEST_enable_db_catalog_version_mode" to the {{<badge/tp>}} gflag "FLAGS_ysql_enable_db_catalog_version_mode", enhancing user control over concurrent DDL execution across different databases. {{<issue 12417>}}
* Issues a notice for unsafe ALTER TABLE operations, including for ADD COLUMN...DEFAULT, to indicate existing rows won't be backfilled with the default value, enhancing user awareness. Suppression possible by setting ysql_suppress_unsafe_alter_notice gflag to true. {{<issue 19360>}}
* Added sorting capabilities to BatchNestedLoopJoin to return the rows in the same order as NestedLoopJoin. {{<issue 19589>}}
* Replaces the `ysql_max_read_restart_attempts` and `ysql_max_write_restart_attempts` gflags with `yb_max_query_layer_retries`, applies limit to Read Committed isolation statement retries, and adjusts `retry_backoff_multiplier` and `retry_min_backoff` defaults. {{<issue 20359>}}
* Disallows the creation of a temporary index with a tablespace, preventing client hangs and providing a clear error message for temporary index creation with set tablespace. {{<issue 19368>}}
* Enables index tablespace modification through the `ALTER INDEX SET TABLESPACE` command and regulates column statistics using the `ALTER INDEX ALTER COLUMN SET STATISTICS` command. Also, allows the creation and alteration of materialized views with the specified tablespace. Suppress the beta feature warning by enabling `ysql_beta_feature_tablespace_alteration` flag. {{<issue 6639>}}
* Adds function to log the memory contexts of a specified backend process, enhancing memory usage monitoring and allowing users to troubleshoot memory-related issues more effectively. {{<issue 14025>}}

##### DocDB

* Allows customizing retryable request timeouts to respect client-side YCQL and YSQL timings, optimizing log replay and preventing the tserver from rejecting requests that exceed durations. Adjusts default retryable request timeout to 660 seconds and offers a configuration to eliminate server-side retention of retryable requests with `FLAGS_retryable_request_timeout_secs =0`. {{<issue 18736>}}
* Speeds up TServer Init by optimizing the handling of deleted and tombstoned tablets. It ensures faster startup by using a new flag `num_open_tablets_metadata_simultaneously`, which sets the number of threads for opening tablet metadata. This allows for parallel opening of metadata, improving response times even in cases with large numbers of tablets. Additionally, the handling of tablets marked as `Deleted` or `Tombstoned` is managed asynchronously, marking tombstoned tablets as dirty for inclusion in the next heartbeat. {{<issue 15088>}}
* Logs all instances of tablet metadata creation/updation, enabling additional insights for troubleshooting in cases of multiple meta records for the same tablet. {{<issue 20042>}}
* Adds a 10-second delay (`auto_flags_apply_delay_ms`) between AutoFlag config updates and their application, allowing all tservers to receive the new config before applying it. This change enhances configuration consistency and update safety. {{<issue 19932>}}
* Enhances thread safety by setting `Wthread-safety-reference` to check when guarded members are passed by reference and resolving all build errors resulting from this change. {{<issue 19365>}}
* Automates recovery of index tables impacted by a bug, preventing performance degradation and disk size leak, by ensuring schema.table_properties.retain_delete_markers is reset to false when index backfilling is done. {{<issue 19731>}}
* Enhances the `demote_single_auto_flag` yb-admin command by returning distinct error messages for invalid process_name, flag_name, or non-promoted flag, thereby aiding easier identification of errors. Replaces `HasSubstring` with `ASSERT_STR_CONTAINS` in the AutoFlags yb-admin test. {{<issue 20004>}}
* Introduces support for Upgrade and Downgrade of universes with xCluster links, enhancing compatibility checks for AutoFlags during these operations. Data replication between two universes is only catered if AutoFlags of the Target universe are compatible with the Source universe. The compatibility check, stored in `ProducerEntryPB`, triggers if the AutoFlag configuration changes during upgrades and rollbacks. This prevents unnecessary RPC calls if no AutoFlag configurations have changed. Also includes fixes for cds initialization bugs in `TestThreadHolder`. {{<issue 19518>}}
* Offers redesigned server level aggregation for metrics, thus introducing more metrics for enhanced debugging. Removes several unused URL parameters and makes the new output compatible with YBA and YBM, preventing double-counting issues in charts. Drops unused JSON and Prometheus callbacks from MetricEntity for a cleaner design. {{<issue 18078>}}
* Allows a limit on the addition of new tablet replicas in a cluster to conserve CPU resources, with safeguards for downscaling. Introduces test flags for controlling memory reservation and tablet replica per core limits. {{<issue 16177>}}
* Introduces verbose logging for global and per table state transitions in the load balancer to facilitate easier debugging. {{<issue 20289>}}
* Reduces server initialization time by eliminating the accumulation of deleted tablet superblocks during startup, through a modification in the `DeleteTablet` operation. {{<issue 19840>}}
* Enables automatic recovery of index tables affected by a bug, verifying their backfilling status and correcting the `retain_delete_markers` property to enhance performance. {{<issue 20247>}}
* Includes single shard (fast-path) transactions in the pg_locks by querying single shard waiters registered with the local waiting transaction registry at the corresponding Tserver, ensuring more complete transaction tracking and lock status reporting. {{<issue 18195>}}
* Creates Prometheus metrics for server hard and soft memory limits which allow detailed insight into TServer or master memory usage regardless of Google flag defaults; aids in creating dashboards charts to monitor utilization close to soft limit or TServer TCMalloc overhead. {{<issue 20578>}}
* Enables control over the batching of non-deferred indexes during backfill via a new flag, improving index management. {{<issue 20213>}}

</details>