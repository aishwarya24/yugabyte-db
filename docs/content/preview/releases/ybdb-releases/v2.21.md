---
title: What's new in the v2.21 preview release series
headerTitle: What's new in the v2.21 preview release series
linkTitle: v2.21 series (Preview)
description: Enhancements, changes, and resolved issues in the v2.21 preview release series.
image: /images/section_icons/quick_start/install.png
aliases:
  - /preview/releases/release-notes/latest-release/
  - /preview/releases/whats-new/latest-release
menu:
  preview_releases:
    identifier: v2.21
    parent: ybdb-releases
    weight: 2810
type: docs
---

{{< tip title="YugabyteDB Anywhere release notes have moved" >}}
Starting with v2.16, the [release notes for YugabyteDB Anywhere](../../yba-releases/) have moved to [their own page](../../yba-releases/v2.21/).
{{< /tip >}}

What follows are the release notes for the YugabyteDB v2.21 release series. Content will be added as new notable features and changes are available in the patch releases of the YugabyteDB v2.21 release series.

For an RSS feed of all release series, point your feed reader to the [RSS feed for releases](../../index.xml).

## v2.21.0.0 - March 25, 2024 {#v2.21.0.0}

**Build:** `2.21.0.0-b545`

### Downloads

<ul class="nav yb-pills">
  <li>
    <a href="https://downloads.yugabyte.com/releases/2.21.0.0/yugabyte-2.21.0.0-b545-darwin-x86_64.tar.gz">
      <i class="fa-brands fa-apple"></i>
      <span>macOS</span>
    </a>
  </li>
  <li>
    <a href="https://downloads.yugabyte.com/releases/2.21.0.0/yugabyte-2.21.0.0-b545-linux-x86_64.tar.gz">
      <i class="fa-brands fa-linux"></i>
      <span>Linux x86</span>
    </a>
  </li>
  <li>
    <a href="https://downloads.yugabyte.com/releases/2.21.0.0/yugabyte-2.21.0.0-b545-el8-aarch64.tar.gz">
      <i class="fa-brands fa-linux"></i>
      <span>Linux ARM</span>
    </a>
  </li>
</ul>

**Docker:**

```sh
docker pull yugabytedb/yugabyte:2.21.0.0-b545
```

### Highlights

**PostgreSQL Emulation mode**

We're pleased to announce the tech preview of the new PostgreSQL emulation mode in the 2.21.0.0 release. This mode enables you to take advantage of many new improvements in both code compatibility and performance parity, thus making it even easier to lift and shift your applications from PostgreSQL to YugabyteDB. When this mode is turned on, YugabyteDB will use the [Read-Committed](../../../architecture/transactions/read-committed/) isolation mode, the [Wait-on-Conflict](../../../architecture/transactions/concurrency-control/#wait-on-conflict) concurrency mode for predictable P99 latencies, and the new Cost Based Optimizer that takes advantage of the distributed storage layer architecture and includes query pushdowns, LSM indexes, and [batched nested loop joins](../../../explore/ysql-language-features/join-strategies/#batched-nested-loop-join-bnl) to offer PostgreSQL like performance.

You can enable the emulation mode by passing the `enable_pg_parity_tech_preview` flag to [yugabyted](../../../reference/configuration/yugabyted/#yugabyted), when bringing up your cluster.

For example, from your YugabyteDB home directory, run the following command:

```sh
./bin/yugabyted start--enable_pg_parity_tech_preview
```

**New YugabyteDB Kubernetes Operator**

A preliminary version of the completely rewritten YugabyteDB Kubernetes Operator is available in [Tech Preview](/preview/releases/versioning/#feature-availability). The new operator automates the deployment, scaling, and management of YugabyteDB clusters in Kubernetes environments. It streamlines database operations, reducing manual effort for developers and operators.

For more information, refer to the [YugabyteDB Kubernetes Operator](https://github.com/yugabyte/yugabyte-k8s-operator) GitHub project.

**Changes in supported Operating Systems**

Please note that YugabyteDB 2.21.0.0 and newer releases do not support v7 Linux versions (CentOS7, RHEL7, Oracle Enterprise Linux 7.x), Amazon Linux 2, and Ubuntu 18. If you're currently using one of these Linux versions, please upgrade to a supported OS version before installing YugabyteDB 2.21.0.0 version. Refer to [Operating system support](../../../reference/configuration/operating-systems/), for the complete list of supported Operating Systems.

### New features

* [New Kubernetes Operator](https://github.com/yugabyte/yugabyte-k8s-operator). Automated deployment and management of  clusters via the Kubernetes operator pattern. Includes support for YugabyteDB universes as a Kubernetes custom resource. Backup, upgrade, scale-out, scale-in, and more are possible on this Kubernetes custom resource. {{<badge/tp>}}

* [Backup and restore support in yugabyted](../../../reference/configuration/yugabyted/). yugabyted CLI enabled support for taking database/keyspace backups. You now have the capability to upload backups to public clouds, including AWS and GCP. {{<badge/tp>}}

* DDL concurrency. Support for isolating DDLs per database. Specifically, a DDL in one database does not cause catalog cache refreshes or aborts transactions due to breaking change in another database. {{<badge/tp>}}

* YSQL: DDL atomicity. Ensures that YSQL DDLs are fully atomic between YSQL and DocDB layers, that is in case of any errors, they are fully rolled back, and in case of success they are applied fully. Currently, such inconsistencies are rare but can happen. {{<badge/tp>}}

* YSQL: Lower latency for large scans with size-based fetching. A static size based fetch limit value to control how many rows can be returned in one request from DocDB. {{<badge/tp>}}

* [YSQL: ALTER TABLE support](../../../api/ysql/the-sql-language/statements/ddl_alter_table/#add-column-if-not-exists-column-name-data-type-constraint-constraints). {{<badge/tp>}} Adds support for the following variants of ALTER TABLE ADD COLUMN:
  * with a SERIAL data type
  * with a volatile DEFAULT
  * with a PRIMARY KEY

### Change log

<details>
  <summary>View the detailed changelog</summary>

#### Improvements

##### YSQL

* Alters the YSQLDump to generate `CREATE INDEX NONCONCURRENTLY` instead of `CREATE INDEX`, preventing automated index back-filling in the backup-restore, thereby accelerating the process. {{<issue 19457>}}
* Ensures Row Level Security (RLS) policy remains intact during table rewrite by accurately copying both `relrowsecurity` and `relforcerowsecurity` fields. {{<issue 19815>}}
* Blocks the use of advisory locks in YSQL and responds to the external client with an error message when they are requested. {{<issue 18954>}}
* Adjusts the webserver's Out Of Memory (OOM) score through the `yb_webserver_oom_score_adj` flag (default 900) to prevent unnecessary shutdowns while allowing quick termination if it starts consuming excessive memory. {{<issue 20028>}}
* Sets `yb_bnl_batch_size` to 1024 and `yb_prefer_bnl` to true by default, ensuring BNL's replace nested loop joins without altering non-NL join plans. {{<issue 19273>}}
* Replaces remaining unnecessary scans of the pg_inherits table with cache lookups, reducing wasteful calls to the YB-Master and optimizing DDL operations. Fixes a structuring bug in the INHERITSRELID cache for better future compatibility. {{<issue 10478>}}
* Introduces a new flag, `ysql_use_relcache_file`, to control the use of relcache init file, helping regulate Postgres backend memory usage, and modify unpredicted system table preloading, reducing overall memory usage. {{<issue 19226>}}
* Introduces asynchronous support for `ALTER INDEX SET TABLESPACE`, `ALTER INDEX ALTER COLUMN SET STATISTICS`, `CREATE MATERIALIZED VIEW` with `TABLESPACE`, and `ALTER MATERIALIZED VIEW SET TABLESPACE` enhancing database flexibility, with a traceable warning for beta features that can be muted by adjusting the `ysql_beta_feature_tablespace_alteration` flag to true. {{<issue 6639>}}
* Changes the default unit for the yb_fetch_size_limit to bytes from kilobytes, allowing a size limit setting to non-integer kilobyte values, enhancing query performance during upgrades. {{<issue 18522>}}
* Replaces outdated PGConn Fetch* functions with more robust versions for improved database testing, now supporting additional BasePGType and OptionalPGType elements. {{<issue 19906>}}
* Prevents creation of index with TABLESPACE on a temporary table, averting client hangups and displaying an error message: `ERROR: cannot set tablespace for temporary index` instead. {{<issue 19368>}}
* Reduces contention and potential deadlock risk during the execution of pg_stat_activity request by introducing a transaction cache at the t-server, which stores the active sessions and their transaction mapping. This allows the request to access the cache under a shared lock, alleviating the need for an exclusive lock. {{<issue 18711>}}
* Resolves the `record type not registered` error that appeared when retrieving fieldnames for batched index condition expressions in YB Batched Nested Loop through bypassing fieldname resolution for indecipherable batched expressions. {{<issue 19094>}}
* Trims unnecessary master RPC calls during connection initialization by removing `YB_YQL_PREFETCHER_NO_CACHE` enum value and introducing `YBCStartSysTablePrefetchingNoCache` function. {{<issue 19304>}}
* Enables the PgIndexBackfillTest.NoAbortTxn C++ test for explicit flag setting, increasing its resilience against any default changes in YSQL backend manager flags. {{<issue 19351>}}
* Strengthens PgIndexBackfillTest.NoAbortTxn and other tests to endure potential YSQL backends manager flags' default value alterations, thereby boosting resilience. {{<issue 19351>}}
* Enables unified server functionality following process termination by resorting to restarting the postmaster for a crashed or killed Postgres backend, contributing to simplicity and fewer bugs. {{<issue 19180>}}
* Resolves an issue with RowCompareExpression bindings that previously led to incorrect results and occasional crashes in `YbBindScanKeys` by accounting for unique PgGate request conditions. {{<issue 19384>}}
* Reduces unnecessary error logs related to tablespace during initdb by checking the `FLAGS_create_initial_sys_catalog_snapshot` before initiating the tablespace refresh task. {{<issue 19386>}}
* Eliminates unnecessary error logs during initdb bootstrap process by checking for the existence of `pg_yb_tablegroup` catalog only in non-bootstrap mode. {{<issue 19387>}}
* Enhances read committed isolation by enabling each statement to pick a read time on docdb when possible, ensuring more efficient operations and adding a test for this functionality. {{<issue 19397>}}
* Removes the `TransactionCache` class shifting session's transactions' information closer to the session in the `SessionInfo` structure, averting a potential deadlock scenario by ensuring smoother test execution when per-database catalog version mode is activated. {{<issue 18711>}}
* Corrects the handling of RowCompareExpression bindings in YbBindScanKeys to prevent inaccurate results and potential system crashes. {{<issue 19384>}}
* Adds pg_hint_plan syntax and functionality to control batched nested loop joins, allows setting hints `YbBatchedNL(t1 t2)` and `NoYbBatchedNL`, and modifies `yb_prefer_bnl` handling. Also, it removes BNL's dependency on `enable_nestloop` and adjusts cost model. {{<issue 19494>}}
* Enables the modification of `is_single_row_txn` for finer control over non-transactional writes required by `COPY`, index backfill, or when `yb_disable_transactional_writes` is set, preventing issues during non-bufferable operations for single row transactions. {{<issue 4906>}}
* Introduces a `NOTICE` for potentially unsafe ALTER TABLE operations (such as altering primary key, altering type), ensuring users are aware of the risks. To suppress this notice, adjust the `ysql_suppress_unsafe_alter_notice` gflag to true. {{<issue 19360>}}
* Adds a new column with both a `NOT NULL` constraint and a non-volatile `DEFAULT` value without needing a table scan, leading to faster YSQL Alter Table operations. No table scan is needed as all existing rows will use the non-volatile `DEFAULT` value in their new column, reducing constraint violation checks time. {{<issue 19355>}}
* Simplifies the code in the pg_dml_read file by replacing the `DocKeyBuilder` helper class with a function and switches from using an arena array to `boost::small_vector`. {{<issue 19685>}}
* Enables an alternative table rewrite approach that only drops and recreates associated DocDB tables and indexes, using the relfilenode field to map a PostgreSQL table OID to the respective DocDB table, resulting in a more efficient way to perform operations such as ALTER TYPE and ADD/DROP primary key. {{<issue 4034>}}
* Enables `PgClientServiceImpl` to periodically clear its own `reserved_oids_map_`, enhancing database cleaning and eliminating reliance on `TabletServer` for scheduling. {{<issue 19916>}}
* Replaces deprecated `FetchValue` with `FetchRow`, simplifying changes and fixing indentation issues in ‘pg_mini-’ without modifying formatting in other areas. {{<issue 19918>}}
* Introduces `yb_silence_advisory_locks_not_supported_error` as a temporary solution for users to avoid disruption when using advisory locks without actual lock acquisition. {{<issue 19974>}}
* Marks the `ysql_enable_read_request_caching` GFlag as non-runtime since Postgres flags, except PG_FLAGs, cannot be dynamically updated, enhancing cache configuration consistency. {{<issue 19983>}}
* Enables ALTER TABLE rewrite commands, adding support for `ALTER TABLE ADD COLUMN` operations and modernizing REINDEX implementation for end-user indexes. {{<issue 19563>}}
* Enables ignoring already existing tablespaces during YSQL DB backup-restore process with the newly added flag `ignore_existing_tablespaces` in the `yb_backup.py` script. {{<issue 20334>}}
* Adjusts preload settings to allow users to specify additional tables in the `ysql_catalog_preload_additional_table_list` without forcing preloading of default tables. {{<issue 20290>}}
* Reworks TID expectations in index scans for more clarity and convenience by sidelining the use of TID t_self or t_ybctid and ensuring the setting of either yb_agg_slot, xs_hitup, or xs_itup. {{<issue 20373>}}
* Refactors IndexScanDesc yb_agg_slot to prevent setting during non-pushdown cases and eliminates return value from ybFetchNext for unnecessary instances, preventing future misuse. {{<issue 20371>}}
* Replaces existing retry attempt flags `ysql_max_read_restart_attempts` and `ysql_max_write_restart_attempts` with a unified GUC variable `yb_max_query_layer_retries` to control retries in all isolation levels including Read Committed, with default reset to 60 retries. Defaults for `retry_backoff_multiplier` and `retry_min_backoff` adjusted to 1.2 and 10ms respectively. {{<issue 20359>}}
* Centralizes all code for creating internal PostgreSQL connections, simplifying usage in ysql_upgrade, ysql index backfill, WaitForYsqlBackendsCatalogVersion and ddl replication. Now utilizes the detailed error message from PGConn::Connect. {{<issue 20655>}}
* Revamps the `ToString` function to create unique responses for optional types (std/boost::optional), enhancing log readability and data relevance. {{<issue 20719>}}
* Adds a new GUC `yb_explain_hide_non_deterministic_fields` to remove non-deterministic fields from EXPLAIN ANALYZE's output, reduces flakiness between runs in `pg_regress` tests. {{<issue 19492>}}
* Corrects formatting errors in the `pg_stat_get_activity` function, aligns variable names, adds `yb_prefix` to `txn_rpc_timestamp`, and applies column indexing based on `PG_STAT_GET_ACTIVITY_COLS` macro. {{<issue 20281>}}
* Relocates `Unknown Session` Unit Test to pg_libpq, renaming it from `PgBackendsTestSessionExpire` to `PgBackendsSessionExpireTest` for convention conformity, enhancing testing protocol. {{<issue 20545>}}

##### YCQL

* Introduces an `UpdateMapRemoveKey` API, enabling the removal of specific keys from a Map, leaving all other keys unaffected. {{<issue 19829>}}

##### DocDB

* Enables tracking of active `WriteQuery` objects and outstanding transaction status rpc requests at the tablet level for easier debugging. {{<issue 18940>}}
* Enhances timeout handling for YCQL index scans to avert overruns, resulting in less log spew, ensuring index tablet scans do not timeout prematurely at the YCQLProxy/YBClient side, and eliminating unnecessary repeated master leader requests. {{<issue 19221>}}
* Replaces glog includes with yb/util, introducing yb VLOG macros for clearer differentiation between INFO and VERBOSE logs, while addressing issues of duplicate includes. {{<issue 15273>}}
* Adjusts the verbose level for VLOG macros to help differentiate between INFO and VERBOSE logs, fostering ease in debugging and analysis with better log filtration. {{<issue 15273>}}
* Eliminates duplicate includes from specific files, providing clearer differentiation between INFO and VERBOSE logs for enhanced user debugging experience. {{<issue 15273>}}
* Accelerates TServer Init by handling deleted and tombstoned tablets asynchronously on startup, therefore, enabling the quick starting of the RPC port. Introduces a new flag `num_open_tablets_metadata_simultaneously` to set the number of threads for opening tablets' metadata during startup, enhancing the startup time. The modification also takes steps towards deleting the superblock in DeletedTablet. {{<issue 15088>}}
* Introduces automatic recovery of index tables affected by a bug, effectively preventing performance degradation and disk size leak by ensuring that tombstones are properly filtered out by compactions once index backfilling is complete. {{<issue 19731>}}
* Enables logging of all instances of tablet metadata creation/updating, providing additional insights in case of tablet server startup crashes due to multiple meta records for the same tablet. {{<issue 20042>}}
* Expands load balancer metrics by incorporating `tablets_in_wrong_placement`, `blacklisted_leaders`, and `tablet_load_variance`, enhancing the tracking of load balancer progress. {{<issue 20118>}}
* Allows for the check of zero bytes at the end of SST data files, and enables an error report with the number of zeros once the flag `rocksdb_check_sst_file_tail_for_zeros` is set to a positive value. {{<issue 19691>}}
* Enables tracing of UpdateConsensus API by activating the `collect_update_consensus_traces` flag, offering visibility into remote follower traces and adding trace messages to local logs. The feature ensures upgrade/rollback safety and impacts the leader and follower only if both incorporate the change. {{<issue 19417>}}
* Introduces the `rocksdb_max_sst_write_retries` flag to set the number of retry attempts if corruption is detected when writing SST file, affecting both flushes and compactions. {{<issue 19730>}}
* Adds a retry mechanism on block checksum mismatches and enhances error logging for better identification of transient read errors. {{<issue 20102>}}
* Refines error messages on block checksum failure by including a retry scheme and logging on success or failure, offering better error tracking. {{<issue 20102>}}
* Adds a URL parameter, `show_help,` to the scrape endpoint, enabling control over display of help and metadata information, overriding the `export_help_and_type_in_prometheus_metrics` GFlag. {{<issue 19176>}}
* Renames `AsyncClientInitialiser` to `AsyncClientInitializer` for consistency in naming conventions. {{<issue 19920>}}
* Introduces flags `tablet_replicas_per_gib_limit`, `tablet_replicas_per_core_limit`, and `tablet_overhead_size_percentage` to customize tablet replication based on cluster resources, enhancing user control over system load balance. {{<issue 16177>}}
* Introduces a new script, analyze_test_results.py, to reconcile discrepancies between Spark-based test runner and JUnit-compatible XML test reports, offering more accurate and reliable test results. {{<issue 18594>}}
* Reduces unwanted logging in LogAfterLoad when a single 0 version is loaded, thus minimizing unnecessary log generation especially when managing many YSQL databases. {{<issue 18489>}}
* Adds a `show-changes` command to the `sys-catalog-tool` to search and provide details of all updated entries marked as `ADD`, `CHANGE`, or `REMOVE`. This needs to be run before `update` to validate the expected changes in the SysCatalog JSON file. Notably, this command exclusively interacts with the file, without reading or writing to the SysCatalog. {{<issue 18800>}}
* Enhances the TCMalloc heap snapshot functionality with additional columns for estimated bytes and samples count from a call stack, allowing direct comparison with the total system memory and accurate proxy for memory usage. {{<issue 19071>}}
* Tracks and batches updates for rocksdb and tablet-level event stats metrics, distinguishing between counter and gauge metrics, and exposing them in `EXPLAIN (ANALYZE, DIST, DEBUG)` and tracing. {{<issue 16785>}}
* Adopts the trace outside the block for ensuring correct execution of per-session tracing with standalone traces, and fixes callbacks to adopt the appropriate trace. {{<issue 19099>}}
* Modifies the use of scan choices to increase effectiveness in scenarios where only the lower bound is specified, enhancing both speed and performance. {{<issue 19117>}}
* Optimizes PgWire response serialization for large query results, enhancing overall read performance. {{<issue 19213>}}
* Reduces high load issues by renaming blocking synchronous YBSession flush functions to `TEST_*` and replacing them with non-blocking asynchronous versions (FlushAsync). {{<issue 12165>}}
* Reduces the safe time lag in the xCluster by sending the apply safe time more frequently when there are no active transactions. {{<issue 19274>}}
* Elevates the timeout in TSAN mode for the PgSharedMemTest.TimeOut test, averting potential table creation timeouts. {{<issue 19313>}}
* Replaces `EnableVerboseLoggingForModule` with `google::SetVLOGLevel` for a less complex procedure in setting the module log level, eliminating the updating of the vmodule gflag. {{<issue 19344>}}
* Renames `cdc` to `xcluster`, moves `ValidateTableSchema` to `xrepl_catalog_manager` and renames it to `ValidateTableSchemaForXCluster`. Revises `allow_ycql_transactional_xcluster` to be a TEST flag, enhances XClusterManager's ability to handle XCluster related control logic, and launches dedicated XClusterConfig class. {{<issue 19353>}}
* Reduces macOS 13.6 linker warnings by updating the compiler to avoid duplicate RPATHs, enables failure on duplicate RPATHs through `YB_FAIL_ON_DUPLICATE_RPATH`, and cleans build system. {{<issue 19378>}}
* Enables thread safety for members passed by reference by setting the `Wthread-safety-reference`, fixing all resulting build errors for increased stability. {{<issue 19365>}}
* Enables `TEST_SYNC_POINT` macro in release builds reducing its impact in production by adding the check for `FLAGS_TEST_enable_sync_points` before making expensive SyncPoint calls. {{<issue 19379>}}
* Introduces XClusterManager to handle all XCluster related control logic in the yb-master, creates a dedicated class XClusterConfig for changes to XClusterConfigInfo, and makes `allow_ycql_transactional_xcluster` a TEST flag. {{<issue 19353>}}
* Adds a `skip_indexes` command line option to `create_snapshot` and `create_keyspace_snapshot`, allowing users to exclude indexes when creating backups in YCQL. {{<issue 14142>}}
* Enhances thread safety analysis by enabling the -Wthread-safety-precise compiler flag, which increases scrutiny on mutex field assignments, and adds the ability to override the compiler type for third-party archive selection using YB_COMPILER_TYPE_FOR_THIRDPARTY environment variable. {{<issue 19462>}}
* Simplifies xCluster code by allocating related tests to a separate file, introducing XClusterManager for better control logic, and establishing a dedicated XClusterConfig class for changes to XClusterConfigInfo. {{<issue 19353>}}
* Removes a disabled test, enhancing master start in shell mode with either an empty `master_addresses` or a set `master_join_existing_universe` flag. {{<issue 19528>}}
* Saves memory and disk space by introducing a JoinStringsLimitCount utility, which limits reporting and logging to the first 20 elements of large number arrays like tablet Ids. {{<issue 19527>}}
* Filters out tservers in the read cluster when determining whether to add new tablet replicas to the cluster, providing the dual ability to manage CPU usage when maintaining idle tablets and ensure robust front-end work operations. This process includes configuration adjustments to `tablet_replicas_per_gib_limit`, `tablet_replicas_per_core_limit`, and `tablet_overhead_size_percentage` flags. {{<issue 16177>}}
* Renames test file "xcluster_ysq_colocated" to "xcluster_ysql_colocated" for enhanced clarity and correction of a previous error. {{<issue 19531>}}
* Allows longer GLog traces exceeding 30k limit by splitting output into less than 30k per line and introduces a new Gflag `trace_max_dump_size` to limit size of printed traces. {{<issue 19532>}}
* Adds a metric for running tablet peers per tserver for easy calculation of tablet peers to cores, and tablet peers to memory ratios on YBM clusters. {{<issue 9647>}}
* Renames `CDCTabletMetrics` to `XClusterTabletMetrics` and several related files, refines metrics retrieval and setting, and enhances handling of race conditions for smoother data management. {{<issue 20079>}}
* Switches `tablet_replicas_per_core_limit` and `tablet_replicas_per_gib_limit` to runtime flags, for setting and adjusting resource-based tablet limits on-the-go. {{<issue 16177>}}
* Enables aggregation of retryable requests mem-tracker metric at table-level for Prometheus by assigning the entity to the mem-tracker after the Tablet opens with the tablet metric entity. {{<issue 19301>}}
* Implements a wait period after the addition of new transaction status tablets, enhancing the stability of XClusterYSqlTestConsistentTransactionsTest.UnevenTxnStatusTablets. {{<issue 19302>}}
* Facilitates the use of remote_build.py tool by interpreting arguments for yb_build.sh even when they couldn't be correctly parsed as remote_build.py arguments. {{<issue 19696>}}
* Introduces the `trace_max_dump_size` Gflag (default 25000) for limiting trace print sizes, works around GLog's character limit for printing long traces, and mitigates flaky test by accounting for glog data flushing latency. {{<issue 19532>}},{{<issue 19769>}}
* Relocates `XClusterConfigInfo` and `XClusterSafeTimeInfo` from `catalog_entity_info.h` to `xcluster_catalog_entity.h`, and from `catalog_loaders.h` to `xcluster_catalog_entity.h`, respectively. Also, establishes a `SingletonMetadataCowWrapper` for singleton catalog entities, creates an XClusterManager interface, and transfers `xcluster_safe_time_info_` and its functions from Catalocustomeranager to `XClusterManager`. {{<issue 19713>}}
* Facilitates a more rapid server initialization by deleting the superblock within the DeleteTablet process when the delete_type is TABLET_DATA_DELETED, reducing the number of DELETED tablet superblocks at server startup. {{<issue 19840>}}
* Introduces a continuation marker for better traceability when a trace segment is split into multiple LOG(INFO) outputs; also adds a new GFlag `trace_max_dump_size` to limit the size of traces printed. {{<issue 19532>}},{{<issue 19808>}}
* Renames `producer_id` to `replication_group_id` in older proto messages, standardizing the replication group identity for enhanced consistency and rollback safety. {{<issue 19825>}}
* Centralizes common helper functions for YCQL xcluster tests into XClusterYcqlTestBase for streamlined testing procedures. {{<issue 19830>}}
* Balances tablet load more evenly across all drives, preventing bottlenecks during remote-bootstrapping by evenly distributing tablets and utilizing available disk bandwidth. {{<issue 19846>}}
* Introduces additional debug logs for troubleshooting `SELECT` statement errors that could arise from processing non-provisional records or writing provisional records without a hybrid timestamp. {{<issue 19876>}}
* Eliminates usage of UNKNOWN flags in tools, marking them as NON_RUNTIME since dynamic update of these flags is not supported. {{<issue 20123>}}
* Renames the misleading `cdc` xCluster metric entity to `xcluster`, ensuring an accurate representation without affecting dependencies as services like YBA rely on the unchanged metric name. {{<issue 20131>}}
* Establishes a flag to manage indexing backfills, offering control over whether non-deferred indexes should be batched during the backfill operation. {{<issue 20213>}}
* Delivers automatic recovery for index tables affected by a bug previously found and addressed, preventing any future performance issues triggered by incorrectly set property values. {{<issue 20247>}}
* Changes `Successfully read [n]ops from disk.` logs to verbose logging, lowering the frequency of identical log outputs and boosting performance. {{<issue 20287>}}
* Allows configuration of the yb_build.sh script via .git/yb_buildrc and ~/.yb_buildrc bash scripts, to specify implicit arguments or alternative defaults before parsing command line arguments. {{<issue 20291>}}
* Marks the Tserver flag `num_concurrent_backfills_allowed` as RUNTIME instead of UNKNOWN for better manageability. {{<issue 20348>}}
* Marks the `force_global_transactions`, `ycql_use_local_transaction_tables`, and `auto_promote_nonlocal_transactions_to_global` gflags as runtime, enabling them to be changed directly as required for each new transaction. {{<issue 20479>}}
* Organizes AutoFlags management across dedicated MasterAutoFlagsManager, TserverAutoFlagsManager and subset AutoFlagsManagerBase, offering neat code architecture and resolving a bug in Master::InitAutoFlags. {{<issue 19958>}}
* Renames `cdc::ProducerTabletInfo` to `cdc::TabletStreamInfo` and removes ReplicationGroupId from it, relocates ReplicationGroupId from cdc to xcluster namespace, and introduces `xcluster::ProducerTabletInfo` to optimize naming consistency. {{<issue 20452>}}
* Adds Prometheus metrics for server hard and soft memory limits, enabling better tracking of memory use in TServer or master and creation of dashboard charts for universes using non-default values. {{<issue 20578>}}
* Introduces a helper function that checks if a CowObject has a write lock, offering special functionality in retail mode and debug mode for enhanced thread safety. {{<issue 20599>}}
* Eliminates the issue of accessing erased objects in the ClusterLoadBalancer::RunLoadBalancerWithOptions, enhancing the runtime performance. {{<issue 20673>}}
* Streamlines bloom filter key calculation by avoiding duplicate calculations. This results in approximately 4.5% tserver time improvement, and overall 1.5% performance boost. {{<issue 20720>}}
* Introduces new auto flags to stave off backward compatibility issues related to version 2.20, ensuring the stable existence of previously promoted AutoFlags during process startup time. {{<issue 13474>}}
* Adds verbose logs for frequent global and per-table state changes within a load balancer run for easier debugging. {{<issue 20289>}}

##### CDC

* Allows maxAttempts for RPCs in AsyncClient to be adjustable, decreasing the risk of `Too many attempts` exceptions occurring in a short period. {{<issue 12751>}}
* Introduces a GFlag to toggle automatic tablet splitting for tables within a CDCSDK stream, enhancing user control over replication processes. {{<issue 19482>}}
* Expands support for two new record types: `PG_DEFAULT` and `PG_NOTHING` based on Postgres replica identity types while maintaining backwards compatibility by renaming `ALL`and `MODIFIED_COLUMNS_OLD_AND_NEW_IMAGES` modes to `PG_FULL` and `PG_CHANGE_OLD_NEW` respectively. A failsafe `cdc_enable_postgres_replica_identity` autoflag is added. {{<issue 19260>}}
* Addresses a test failure in `TestCreateCDCStreamForNamespaceLimitReached` by specifically adding the record type `CHANGE` to the stream request. Enables support for two new record types `PG_DEFAULT` and `PG_NOTHING`, while retaining the `ALL` and `MODIFIED_COLUMNS_OLD_AND_NEW_IMAGES` modes. Adjusts settings using the newly added autoflag `cdc_enable_postgres_replica_identity`. {{<issue 19260>}}
* Introduces support for two new record types, `DEFAULT` and `NOTHING`, based on Postgres replica identity types, and renames `ALL` and `MODIFIED_COLUMNS_OLD_AND_NEW_IMAGES` modes to `PG_FULL` and `PG_CHANGE_OLD_NEW` respectively for backward compatibility. It introduces an autoflag `cdc_enable_postgres_replica_identity` during CDC stream creation and adjusts the failing test TestCreateCDCStreamForNamespaceLimitReached by specifying the record type `CHANGE`. {{<issue 19260>}}
* Enables yb-client to create consistent snapshot streams using CreateCDCStream rpc. {{<issue 20177>}}
* Refines the `GetCheckpointResponse` to indicate `snapshot_key` presence only when present, enhancing accuracy of bootstrapping and streaming processes. {{<issue 19292>}}
* Introduces the `UpdateMapUpsertKeyValue` API that lets you update specific keys without needing to re-add all keys, allowing for more efficient updates. {{<issue 19577>}}
* Enhances the CDC State Table's key update efficiency by selectively updating or removing keys as needed, without having to replace the entire map column. {{<issue 19577>}}
* Reactivates the cdcsdk_stream-test for TSAN mode, previously disabled, enhancing overall testing capabilities. {{<issue 19752>}}
* Enables the tests in cdcsdk_snapshot-test to run in TSAN mode, augmenting their utility and coverage. {{<issue 19752>}}
* Alters the default checkpoint type to `EXPLICIT` during stream creation, ensuring no upgrade or rollback issues due to alterations in the default proto field value. {{<issue 18748>}}
* Allows yb-client to apply retries for retryable error codes, preventing the unnecessary resetting of attempts and deadlines when a CDCErrorException is encountered. {{<issue 19648>}}
* Refactors tests to use `ASSERT_EQ` assertions, not `ASSERT_GE`, for checking consumed record count, utilizing `GetChangeRecordCount` method for more accurate record handling and tablet splitting. {{<issue 20261>}}

##### yugabyted

* Corrects the CPU usage Sankey diagram to accurately report used and available values, enhancing reliability of performance metrics on the `performance page.` {{<issue 19991>}}
* Rectifies confusion with the yugabyted-UI; password authentication no longer incorrectly shows as enabled for an insecure cluster unless the encryption-at-rest is activated. {{<issue 19295>}}
* Rectifies the misalignment in the display of status messages for specific scenarios in yugabyted. {{<issue 19334>}}
* Corrects the display of the total number of CPUs on the overview page and ensures live queries show all statuses, not just idle. {{<issue 19414>}}
* Corrects `join` flag bugs, ensuring a smooth start command even if a node's join IP is not an active master and enables error handling when the placement_uuid from the join IP can't be obtained. Now supports Hostnames and handles edge cases for addresses provided through CLI. {{<issue 19316>}},{{<issue 19314>}}
* Adjusts the `yugabyted start` command to interpret `0.0.0.0` as `127.0.0.1` in the advertise_address, aligning with the IP use in master, tserver, and yugabyted-UI. {{<issue 18580>}}
* Adds prerequisite checks to confirm if default ports are open before yugabyted starts, resulting in either failure to launch or impaired functionality with warnings depending on the blocked ports. {{<issue 19504>}}
* Enables Yugabyted UI to display `Alert` messages from all nodes by directing API calls through the yugabyted API server. {{<issue 19972>}}
* Resolves an issue where the UI failed to launch when `advertise_address=0.0.0.0` by ensuring `127.0.0.1` is used instead, and adds a connection check for address uniqueness and timeout for tserver API calls. {{<issue 18580>}}
* Enables the starting of two different local RF-1 instances on Mac by adding a check for empty `join` flag during the second node's initiation. {{<issue 20018>}}
* Removes the deprecated gflag `use_initial_sys_catalog_snapshot`, replaced by `enable_ysql` that is now true by default, eliminating repetitive warning messages on starting yugabyted nodes. {{<issue 20056>}}
* Adapts yugabyted-ui to efficiently support Kubernetes (k8s) deployments, ensuring correct function for nodes with only masters. A new `bind_address` flag added for customizing the API server's bind address. {{<issue 20301>}}
* Rectifies the malfunction in yugabyted-ui when yugabyted utilizes custom `ysql_port` and `ycql_port` values by introducing a new flag for YCQL port number. {{<issue 20406>}}
* Updates the yugabyted-ui backend to align with changes in the connection manager stats consumed from the `:13000/connections` endpoint, catering for removal of `pool_name` and addition of `database_name` and `user_name`. {{<issue 20494>}}
* Adds yugabyted-ui support to the K8s OSS Yugabyte helm chart, including new values to control UI and metrics snapshotter activation for enhanced metrics visualisation in the K8s environment. {{<issue 20344>}}
* Retains the integrity of user's custom configuration file by associating `config` flag with start command, and directs updates to a yugabyted generated file within base_dir/conf directory. {{<issue 20881>}}
* Allows a smooth restart of the second node in a cluster using the `join` flag without throwing any errors. {{<issue 20684>}}
* Enables a predefined set of gflags related to the pg-parity project using the `enable_pg_parity` flag in the yugabyted start command. {{<issue 21221>}}
* Changes the flag `enable_pg_parity` to `enable_pg_parity_tech_preview` for activating a predefined set of gflags related to the pg-parity project with the yugabyted start command. {{<issue 21221>}}

##### Other

* Simplifies reading of remotely fetched traces by introducing proper nesting levels and splitting multi-line trace entries into different lines. {{<issue 19758>}}
* Switches release packaging to use native libraries on lowest common version (centos7 for linux-x86) instead of linuxbrew libraries, introducing changes to the default calculation for linuxbrew builds in the 2.21 release. {{<issue 19219>}}
* Redefines release packaging to use native library build instead of linuxbrew, boosting compatibility with later OS versions. Changes the default setting for linuxbrew builds to false. Fixes shellcheck errors in compiler wrapper. {{<issue 19219>}}
* Redesigns build options parsing in Jenkins for better compatibility, switching from YB_BUILD_OPTS evaluation to YB_*environment variables, and mends shellcheck mistakes in compiler wrapper. {{<issue 19219>}}
* Corrects the Jenkins build error that occurred when YB_BUILD_OPT was not set, ensuring smooth build operations even in the absence of YB_BUILD_OPTS. The change switches the packaging method to use native library build instead of Linuxbrew, offering better compatibility with later OS versions. {{<issue 19219>}}

#### Bug fixes

##### YSQL

* Introduces a per-database PG new OID allocator, ensuring OID uniqueness within the database and enhancing horizontal scalability in multi-node and multi-tenancy environments. This new mechanism mitigates OID collisions and allows OID consistency in backup-restore scenarios across clusters. A new GFlag `ysql_enable_pg_per_database_oid_allocator` is provided to return to old OID allocator behavior if necessary. {{<issue 16130>}}
* Restarts the postmaster when a process is killed during its own initialization or cleanup to prevent potential mishandling of shared memory items. {{<issue 19945>}}
* Converts the "Unknown session" error into a FATAL error, allowing drivers to instantly finish a non-responsive connection, enhancing client connection management. {{<issue 16445>}}
* Corrects a backup failure issue by ensuring the function `yb_catalog_version` is introduced, especially in 2.4.x or 2.6.x clusters where it was previously missed due to a YSQL upgrade code bug. {{<issue 18507>}}
* Ensures the Linux `PDEATH_SIG` mechanism signals child processes of their parent process's exit, by correctly configuring all PG backends immediately after their fork from the postmaster process. {{<issue 20396>}}
* Enables cleanup after killed backends, fixing an issue where killing a background worker uses up a Proc struct, therefore preventing the webserver from failing after 8 attempts. {{<issue 20154>}}
* Releases memory to the operating system after processing each endpoint call, effectively managing large amounts of data produced by long and unique queries and preventing unnecessary accumulation of memory. {{<issue 20040>}}
* Eliminates segmentation fault in webserver SIGHUP handler at cleanup by ensuring `MyLatch` usage in all instances in order to manage process life cycle. {{<issue 20309>}}
* Corrects the inaccurate detection of constants in distinct prefix computation during distinct index scans, ensuring reliable query results for batch nested loop joins. {{<issue 20827>}}
* Renders a fix for memory corruption issue that caused failure in creating a valid execution plan for `SELECT DISTINCT` queries. Enables successful execution of queries without errors and prevents server connection closures by disabling `distinct pushdown`. This fix improves the stability and effectiveness of SELECT DISTINCT queries. {{<issue 20893>}}
* Trims down the probability of inaccurate behaviour involving conflicts between single shard INSERT operations by ensuring read times are chosen after conflict resolution, enhancing data consistency. {{<issue 19407>}}
* Corrects the incrementation timing of pg_stat_user_indexes idx_scan column for LSM index for accurate stat generation, ensuring it no longer increments too early. {{<issue 17495>}}
* Reduces spinlock deadlock detection time by 75% for prompt handling of potential freezes and restarts Postmaster when a process holding a spinlock is killed, ensuring successful initiation of new connections. {{<issue 18272>}},{{<issue 18265>}}
* Prevents potential postmaster crashes during cleanup of killed connections by using the killed process's ProcStruct to wait on an unavailable LWLock. {{<issue 18000>}}
* Overhauls the handling of DDL statements, preventing them from restarting in READ COMMITTED mode, better managing DDL transactions, and ensuring more immediate clean-up of DDL transactions. {{<issue 18761>}}
* Rectifies the issue of filters not binding to the request by amending the erroneous duplication-check of the bindings on the first column of the row element, enhancing query performance. {{<issue 19308>}}
* Resolves an issue by safely dropping all foreign key constraints in one pass, preventing errors when altering a column referenced by a foreign key in partitioned tables. {{<issue 19063>}}
* Cures null constraint violations in ALTER TYPE operations and failures on tables with a range key, ensuring accurate operation and error reduction. {{<issue 18911>}},{{<issue 19382>}}
* Restores previous conditions after test PgRegressIndex yb_index_scan fails due to a commit reversion. {{<issue 19477>}}
* Eliminates unnecessary file creation for views on temporary tables by checking if storage is actually needed. {{<issue 19522>}}
* Moves estimated seeks and `nexts` in the EXPLAIN plan from VERBOSE to DEBUG flag, enhancing Sequential Scan nodes to include these estimates. {{<issue 19938>}}
* Corrects DDL Atomicity by cleaning up failed `CREATE TABLE` operations, allowing for multiple sub-commands in `ALTER TABLE ALTER COLUMN TYPE`, adequately looking up Materialized views in PG schema, and addressing `order` field-dependency in DocDB columns. {{<issue 19605>}}
* Corrects an error that prevents the `ALTER TABLE SET TABLESPACE` command from executing successfully when the cluster has a `placement_uuid` set, by properly filling in the `placement_uuid` during validation. {{<issue 14984>}}
* Reduces maintenance time by switching to a less complex implementation of SideBySideDiff.java, thereby eliminating errors from `SideBySideDiff.sanityCheckLinesMatch`. {{<issue 19690>}}
* Prevents PostgreSQL backend crashes induced by assert errors in the YbPgInheritsCache as it now correctly cleans up unreleased references, improving transaction reliability. {{<issue 19807>}}
* Safeguards against potential bugs by ensuring that `yb_transaction_priority_lower_bound` and `yb_transaction_priority_upper_bound` are disregarded in read committed isolation, irrespective of the `enable_wait_queue` status. {{<issue 19921>}}
* Adjusts the shared relcache init file invalidation to ensure correct refresh of the rel cache after executing DDL statements, ensuring consistency with Postgres results. {{<issue 19955>}}
* Streamlines the creation of a publication for all tables in per-database catalog version mode by making updates to `pg_yb_catalog_version` that bypass `CheckCmdReplicaIdentity` function, eliminating DDL errors. {{<issue 19965>}}
* Eliminates unnecessary catalog version incrementation on no-op GRANT DDL statements to enhance optimization by rectifying a previously missed case. {{<issue 19981>}}
* Allows successful dropping of table groups when DDL Atomicity is enabled by verifying if the tables within the group are marked for deletion, instead of ensuring the group is empty. {{<issue 20002>}}
* Revises YbSeqScan to send `ysql_catalog_version` in user-initiated system table requests, ensuring system table scans use an up-to-date catalog and reducing chances of TestPgRegressIndex failure. {{<issue 20017>}}
* Rectifies the assertion failure issue in the per-database catalog version mode. The fix updates the conditions for treating DDL statements, eliminating previous failures caused by treating some DDL statements as non-DDL statements. {{<issue 19975>}}
* Increases the delay when restarting the test cluster in tsan build to prevent occasional failures in unit test PgOidCollisionTest.TablespaceOidCollision/0. {{<issue 20008>}}
* Resolves a bug ensuring `ddl_transaction_state` gets properly reset even if `YbIncrementMasterCatalogVersionTableEntry` throws an exception, preventing non-global DDL statements from being incorrectly handled as global ones. {{<issue 20038>}}
* Prevents a possible system crash in YSQL backends manager by ensuring essential checks are in place before using the job database object. {{<issue 20060>}}
* Ensures removal of both shared and per-database relation cache initialization files during postmaster startup to prevent the reusing of outdated files. {{<issue 20125>}}
* Disables CheckCmdReplicaIdentity for tables when yb_non_ddl_txn_for_sys_tables_allowed is set to true, preventing YSQL upgrades from failing during update/delete operations on system tables. {{<issue 20085>}},{{<issue 20143>}}
* Eliminates the possibility of a segfault during the LWLock process when the postmaster cleans up a killed process, by using `KilledProcToCleanup` instead of `MyProc`. {{<issue 20166>}}
* Restores PostgreSQL 11 code to its original format, facilitating an easier merge with PG15. {{<issue 20176>}}
* Enhances visibility and debugging capabilities by introducing two boolean flags, which log every endpoint access and print basic `tcmalloc` stats after path handler and garbage collection. Now `yb_pg_metrics` handles the `SIGHUP` signal to update flags values. Also adds `:13000/memz` and `:13000/webserver-heap-prof` to expose memory usage with a new runtime variable to control tcmalloc sampling. {{<issue 20157>}}
* Introduces the `pg_stat_statements.yb_qtext_size_limit` flag, controlling the maximum file size read into memory, limiting potentially large or corrupt qtext files impacting system memory usage. {{<issue 20211>}}
* Unveils fresh insight into webserver memory usage through the creation of `:13000/memz` and `:13000/webserver-heap-prof` for printing tcmalloc stats and displaying current or peak allocations, respectively. {{<issue 20157>}}
* Rectifies an issue with corrupted state manipulation, caused by processes being killed during writing, by restarting the postmaster anytime a backend is extraordinarily killed in a critical section. This helps avoid infinite loops and CPU overuse, thereby enhancing database stability. {{<issue 20255>}}
* Caps retrieval of `beentry` from `localhost:13000/rpcz` to 1000 iterations, preventing indefinite waits and ensuring safety even in cases of inconsistent states. {{<issue 20274>}}
* Blocks new-version DDL statements in an invalid per-database catalog version configuration to avoid possible stale read/write RPCs and provide accurate results during cluster upgrades. {{<issue 20300>}}
* Renames the `debug` field in `ExplainState` to `yb_debug` and repositions it to the bottom of the struct for clarity purposes. {{<issue 20366>}}
* Reduces likelihood of `Restart read required` error during Cross-DB Concurrent DDLs with per-database catalog version enabled by initiating the function `YbInitPinnedCacheIfNeeded` before starting the DDL transaction. Also, improper usage of `yb_non_ddl_txn_for_sys_tables_allowed` with a DDL statement has been rectified. {{<issue 20303>}}
* Increases the schema version of the default partition whenever you create a new partition, preventing erroneous data insertion into the default partition due to cache refresh issues. {{<issue 17942>}}
* Revamps the initialization of YbPgInheritsCache's hash table to use binary comparison with HASH_BLOBS flag, ensuring correct hash lookups, while also stopping marathon Java partitioning tests on TSAN to prevent timeouts and test failures. {{<issue 20436>}}
* Mitigates MISMATCHED_SCHEMA error in cross DB concurrent DDLs with per-database catalog version turned on, by ensuring backends only apply messages sent by themselves. {{<issue 20340>}}
* Eliminates tsan warnings in the MetricWatcher helper class by using MetricEntity class, preventing potential test failures. {{<issue 20580>}}
* Corrects the division by zero error occurring with certain queries when the `yb_enable_base_scans_cost_model` is activated and `yb_fetch_size_limit` is enforced by setting a fixed size for result width when it equals zero. {{<issue 20892>}}
* Reduces PostgreSQL connection startup timeouts in geo-distributed clusters with a new `wait_for_ysql_backends_catalog_version_master_tserver_rpc_timeout_ms` GFlag, increasing the default timeout value to 60s from 30s. This alteration only impacts one specific RPC - WaitForYsqlBackendsCatalogVersion, not all RPCs, which should diminish time-out incidents. {{<issue 18228>}}
* Fixes YSQL upgrade failure from 2.16 to 2.21 by adding a 2-second delay before moving to the next connection if the previous script included a breaking DDL statement. {{<issue 20842>}}

##### YCQL

* Solves a concurrency issue in the TestCQLServiceWithCassAuth.TestReadSystemTableAuthenticated unit test by adjusting the CQLServer's shared_pointer reset method. {{<issue 17779>}}

##### DocDB

* Streamlines transaction processing by updating TabletState only for tablets engaged in writes and ignoring old statuses during transaction promotion, reducing failure errors and boosting consistency. {{<issue 18081>}},{{<issue 19535>}}
* Resolves an inconsistency problem where indexes grow in size even after delete operations, causing slower query performance. The fix involves intelligent handling of backfill done events on the tablet server side. Note, it only works for newly created indexes and will not auto-recover from current buggy states. {{<issue 19544>}}
* Includes a script to ensure no index tables retain delete markers post-backfill, addressing a bug causing indexes to expand in size following row deletion, which slowed queries. The bug affected both YCQL and YSQL APIs for new indexes created with versions 2.14.x/2.16.x/2.18.x and led to increasing storage needs due to accumulated delete markers. This script negates these issues and boosts index performance. {{<issue 19544>}}
* Handles backfill responses getting interleaved across different operations more gracefully to prevent crashes caused by slow masters or network delays. {{<issue 20510>}}
* Reintroduces bloom filters use during multi-row insert, improving conflict resolution and rectifying missing conflict issues, while also addressing GH 20648 problem. {{<issue 20398>}},{{<issue 20648>}}
* Deactivates the packed row feature for colocated tables, averting potential write failure issues identified in 20638 during specific kinds of compactions. {{<issue 21047>}}
* Filters out external intents beyond producer tablet range to address disparity in tablet partitions, ensuring each consumer tablet only receives relevant intents. This resolves the issue of potential hidden batch records due to erroneous starting of write_ids from zero. {{<issue 19728>}}
* Resolves the issue where transactions continue and commit despite supposed immediate abort after promotion, due to a timing gap between sending UpdateTransactionStatusLocation RPCs and reception of the first PROMOTED heartbeat. This update delays the sending of UpdateTransactionStatusLocation RPCs until the first PROMOTED heartbeat is acknowledged. {{<issue 17319>}}
* Prevents the deletion of active snapshots during a database backup, even if their corresponding tables are dropped, enhancing the reliability of backup operations. {{<issue 17616>}}
* Adjusts calculation of replication lag metrics for split tablet children by incorporating parent tablet's last sent/committed record time, promoting greater accuracy in metric results. {{<issue 17025>}}
* Addresses the bug where large transactions partially apply to regular RocksDB during tablet server restarts, thus ensuring consistent transaction data after restarts. {{<issue 19359>}}
* Allows setting all columns of a row to NULL, resulting in deletion instead of creating a row consisting of NULLs, rectifying an issue during compaction. {{<issue 18157>}}
* Corrects an issue where an invalid filter key negatively affected the performance of backwards scans, by improperly passing all SST files through the bloom filter. This update will be applied to versions 2.20 and 2.18. {{<issue 19440>}}
* Resolves issues of data validation failure and unreachable nodes by properly setting child checkpoints in `cdc_state` during tablet splits, curbing log amplification. {{<issue 18540>}}
* Allows tracing of outgoing calls only if the current RPC is being traced, reducing excessive memory consumption and logging. {{<issue 19497>}}
* Corrects Master's tablet_overhead mem_tracker issue, ensuring it displays accurate memory consumption, addressing discrepancy in MemTracker metric names between TServer and Master. {{<issue 19904>}}
* Resolves a race condition in MasterChangeConfigTest.TestBlockRemoveServerWhenConfigHasTransitioningServer by ensuring the launched async thread operates on a copy of `ExternalMaster*` instead of the mutating `current_masters` vector. {{<issue 19927>}}
* Corrects intermittent index creation failure for empty YCQL tables by evaluating the result of `is_running` rather than checking index state directly, ensuring accurate `retain_delete_markers` and reducing potential performance issues. {{<issue 19933>}}
* Addresses a PITR restore issue by terminating all active transactions, ensuring inserted or updated data doesn't get omitted, and giving a clear signal about the non-application of such transactions. {{<issue 14290>}}
* Adds retries around the leader step down in the PgNamespaceTest.CreateNamespaceFromTemplateLeaderFailover test to allow the target leader time to properly catch up, preventing previous failures. {{<issue 14316>}}
* Prevents system crashes caused by the CallHome class calling a pure virtual function due to a timing issue during system shutdown. {{<issue 18254>}}
* Corrects an Xcluster Consumer shutdown issue encountered during testing by implementing a temporary mitigation that waits for the Flush with a timeout. {{<issue 19402>}}
* Amends `RaftGroupMetadata::CreateSubtabletMetadata` to update the log prefix, preventing the use of parent tablet ID in child tablet's metadata logging. {{<issue 19375>}}
* Resolves crashes in sys-catalog-tool linked with TabletBootstrap failing due to uninitialized transaction_participant_context, enhancing stability. {{<issue 19412>}}
* Enables transaction promotion in TestPgWaitQueuesRegress for an enhanced testing process. {{<issue 19575>}}
* Restores the original behavior of not counting tablets on dead tservers towards the replica count, ensuring accurate representation of under-replicated tablets. {{<issue 17867>}}
* Ensures the correct in-memory state for the master coming out of shell mode by fetching the universe key from other masters, enabling proper decryption of the universe key registry. {{<issue 19513>}}
* Corrects a lock order inversion in the transaction loader to prevent potential deadlock scenarios. {{<issue 19508>}}
* Adds tests for handling indexes in colocated databases in transactional and non-transactional xCluster environments, enhancing database reliability and consistency. Also simplifies `WaitForReplicationDrain` test helper for easier usage. {{<issue 18427>}},{{<issue 16758>}}
* Rectifies the issue causing the XClusterYsqlIndexTest.FailedCreateIndex test to fail by altering the over-aggressive DCHECK to an efficient SCHECK to allow for transient ALTER operations. {{<issue 18967>}}
* Introduces macros that simplify the creation of comma-separated expression lists to a stream, reducing repetition. {{<issue 19761>}}
* Redefines the structure of thirdparty_archives.yml by eliminating redundant fields, implementing sensible default values, and introducing blank lines for improved readability between distinct third-party archive build sections. {{<issue 19883>}}
* Increases the visibility of Remote Bootstrap (RBS) sessions by adding a dedicated tserver page that lists all ongoing RBS sessions, including the remote log anchor sessions. Additionally, amplifies the `Last status` field on the tserver's tablets page to display the source a peer is or has been bootstrapping from. {{<issue 19568>}}
* Resolves a `maybe-uninitialized` compilation error in almalinux8 release gcc11, enhancing the reliability of the code by addressing both identified issues. {{<issue 19987>}}
* Rectifies the `TestYSQLDumpAsOfTime` compilation issue by replacing `<int64_t>` with `<PGUint64>`. {{<issue 19992>}}
* Eliminates the extra verbosity in MiniCluster logs by removing entries with `hk!!`. {{<issue 20007>}}
* Resolves an issue where the webserver may start prematurely and fail, by ensuring `cds::Initialize` is called before executing any function on `cds::threading::Manager`, minimizing race conditions. {{<issue 20119>}}
* Introduces an asynchronous interface for PgClient shared memory exchange, allowing for multiple requests and parallel query processing. {{<issue 20151>}}
* Displays the errno when unable to open `version_metadata.json` or `auto_flags.json` files, providing clarity on the nature of the IO error. {{<issue 20250>}}
* Deprecates the `enable_process_lifetime_heap_sampling` flag, simplifying tcmalloc sampling control to only setting `profiler_sample_freq_bytes`, which if <=0 disables sampling. {{<issue 20236>}}
* Allows early termination of old single statement read-committed transactions facing `kConflict` errors to enhance system throughput. {{<issue 20329>}}
* Eliminates premature shutdowns during transaction status resolution by ensuring the `rpcs_.Shutdown` only occurs after all status resolvers of the participant have ended, avoiding any in-progress status resolver rpc(s). {{<issue 19823>}}
* Fixes `./yb_build.sh help` to correctly display the help command instead of an error message due to a mismatched function name. {{<issue 20390>}}
* Removes non-trivially destructible static initializations from the code, eliminating complexities that could lead to difficult to identify bugs. {{<issue 20407>}}
* Replaces the deprecated `exec_program` command with `execute_process` in CMake, resolving issue 20481 and eliminating potential warning CMP0153 for developers. {{<issue 20481>}}
* Allows bulk load time reduction by packing all values when inserting a row with multiple values into the PostgreSQL layer. Apply the preview flag -ysql_pack_inserted_value to enable this feature and note it currently uses v1 encoding. {{<issue 20713>}}
* Stores the first error from a failed setup replication to ensure more accurate feedback to the user, instead of a final generic error message like `Universe is being deleted`. {{<issue 20689>}}
* Changes the path in `yb_build.sh` to locate `generate_test_truststore.sh` in `$YB_BUILD_SUPPORT_DIR`, solving build failures on GitHub Actions. {{<issue 20747>}}
* Reduces TPCC NewOrder latency by replacing the ThreadPoolToken with a Strand within a dedicated rpc::ThreadPool in PeerMessageQueue's NotifyObservers functions, enhancing speed and efficiency. {{<issue 20912>}}
* Early aborts transactions that fail during the promotion process, enhancing throughput in geo-partitioned workloads and offering stability in geo-partitioned tests. {{<issue 21328>}}
* Eliminates a race condition that can occur when simultaneous calls to `SendAbortToOldStatusTabletIfNeeded` try to send the abort RPC, thus preventing avoidable FATALs for failed geo promotions. {{<issue 17113>}}
* Changes the initial remote log anchor request to be at the follower's last logged operation id index, reducing the probability of falling back to bootstrapping from the leader and improving the success rate of remote bootstraps. {{<issue 19536>}}
* Prevents concurrent heap profiles from running and problematic resetting of sampling frequency, allowing only one heap profile to run at a time. {{<issue 19841>}}
* Resolves use-after-move errors detected by clang-tidy's bugprone-use-after-move-check for increased code stability. {{<issue 20435>}}
* Resolves issues in the under-replicated endpoint algorithm, ensuring correct counting of replicas only when the block's minimum number of replicas has not been fulfilled yet, hence offering accurate replica tally for placement blocks. {{<issue 20657>}}

##### CDC

* Introduces an additional test case ensuring that only tablets belonging to a dropped table get deleted from the cdc_state table. {{<issue 19196>}}
* Eliminates deadlock during the deletion of namespace-level CDC streams, enabling the successful execution of the `ysqlsh drop database` command even when the database has multiple tables. {{<issue 19879>}}
* Resolves an issue preventing newly created tables from being added to the stream metadata and CDC state table after an existing table is dropped, by considering streams in `DELETING_METADATA` state as well as `ACTIVE` state during dynamic table addition. {{<issue 20428>}}
* Removes only non-active tablets from cdc_state in CleanUpCDCStreamsMetadata, including retaining parent split tablets, to preserve essential data during stream cleaning. {{<issue 19348>}}
* Fixes the issue of WAL garbage collection for tables added after stream creation by enabling WAL retention for each such tablet, reducing connector failure. {{<issue 19385>}}
* Reinstates the creation of CDC streams with old record types to ensure backwards compatibility and prevent `CDC error 9` when the `ALL` mode is utilized. {{<issue 19929>}}
* Fixed the decoding of NUMERIC value in CDC records to prevent precision loss by ensuring that the decoded string is not converted to scientific notation if its length is more than 20 characters. Additionally, the fix involves using the string representation with no limit on length and employing the Postgres numeric_out method for decoding, which is identical to the decoding of numerics in a PG query. {{<issue 20414>}}
* Rectifies an error within the CDCService side, where `Merger tried to set tablet safetime to a lower value`. Now, for non-consistent snapshot streams, the `commit_time_threshold` adjusts correctly to the `safe_hybrid_time` value as per the request, instead of always setting to zero. {{<issue 20356>}}
* Rectifies consistent snapshot stream creation by ensuring tablets complete their tasks and snapshot safe opids populate in the cdc_state table for proper initialization. {{<issue 20477>}}
* Allows continuation of tablet fetching, even if certain tables face errors, by logging a warning instead of sending unnecessary errors to the client. {{<issue 19434>}}
* Rectifies `pg_replication_slots` view failure prior to any cdc/xCluster stream creation by refining the logic to read the cdc_state_table only when a cdc stream exists. {{<issue 20073>}}
* Fixes flaky behavior in CDCSDKTabletSplitTest by ensuring `GetChanges` is called after registering children tablets, reducing test failures. {{<issue 20469>}}
* Corrects the AsyncYBClient method to pass the `explicit_cdc_sdk_opid` instead of a `null` value, ensuring proper snapshot checkpointing and enhancing snapshot resume functionality in EXPLICIT mode. {{<issue 19394>}}
* Alleviates a regression in the connector snapshot resume capability by adjusting the key population in `GetChangesRequest`, ensuring the key is populated only when it is not `null`. {{<issue 19394>}}
* Removes potential crash in DEBUG mode by ensuring each entry returned from the cdc_state_table iteration in `pg_replication_slots` view is checked with `RETURN_NOT_OK` before usage. {{<issue 19894>}}
* Increases the value of `FLAGS_update_min_cdc_indices_interval_secs` from 2 to 5, ensuring the CDC state table tablet has enough time to wait for a new leader and correctly update the log. {{<issue 18156>}}
* Corrects the calculation of the `cdcsdk_sent_lag` metric to prevent disproportionate growth, by updating the `last_sent_record_time` with each `SafePoint` record, reducing inconsistency between transactions. {{<issue 15415>}}
* Eliminates errors in streaming changes from child tablets in CDCSDK by accurately determining the slowest consumer and preventing unnecessary Garbage Collection of intents. {{<issue 20284>}}
* Allows propagation of RPC deadline from clients to YB-Master for CreateCDCStream, reducing unnecessary retries and correctly timing out requests. {{<issue 20583>}}
* Resolves memory leak errors in the asan environment caused by not freeing YBCStatus from YBCPgExecCreateReplicationSlot in case of AlreadyPresent or LimitReached errors. {{<issue 20279>}}
* Rectifies timing issues in the CDCSDKConsistentSnapshotTest.TestRetentionBarrierSettingRace, enhancing stability for TSAN builds via application of WaitFor with an adequate timeout. {{<issue 20455>}}
* Prevents write pausing on a tablet for an AlterSchema procedure that is solely setting retention barriers during consistent snapshot stream creation. {{<issue 20620>}}
* Stream creation failures now trigger a thorough cleanup to avoid resource misuse, resolving issues caused by late ALTER TABLE responses. {{<issue 20725>}}

##### yugabyted

* Maintains sticky object count bi-directionally when creating new sub transactions or returning to parent transactions, aligning count with actual usage. {{<issue 20071>}}
* Allows usage of `SET LOCAL` query to set temporary session parameters for specific transactions, with values reverting after transaction completion. {{<issue 19556>}}
* Introduces a JSON endpoint at `/api/v1/mem-trackers`, enhancing data reliability by avoiding parsing of the HTML page at the `/mem-trackers` server endpoint for memory usage data. {{<issue 18057>}}
* Modifies yugabyted UI apiserver to acquire memory usage data from the new JSON endpoint `/api/v1/mem-trackers` instead of parsing HTML from `/mem-trackers`, ensuring more reliability. {{<issue 18057>}}

##### Other

* Ensures the `tserver start` and `tserver stop` scripts successfully terminate all running PG processes, regardless of PID length, enhancing process management. {{<issue 19817>}}
* Updates the condition for HT lease reporting to ensure accurate leaderless tablet detection in RF-1 setup, preventing false alarms. {{<issue 20919>}}
* Increases the `max_stack_depth` from 900kB to 950kB for proper execution and lessens the excessive logging triggered by inherits cache in `yb_pg_errors.sql`. {{<issue 19443>}}
* Reduces disruptions by throttling the master process log messages related to "tablet server has a pending delete" into 20-second intervals. {{<issue 19331>}}
* Prevents segmentation faults in the stats collector after a Postmaster reset, ensuring the stats collector's operations are uninterrupted even when a query is terminated. {{<issue 19672>}}

#### Other

* Streamlines code base by eliminating over 900 unnecessary includes, splitting oversized .proto files, enhancing the `protoc-gen-yrpc` to produce forward headers for protobuf, and upgrading precompiled headers. Also restructures `MasterService`, divides it into smaller services improving build times, and moves encryption-related classes. Updates now allow less system entropy drain via revised UUID generation. {{<issue 10584>}}
* Validates the use of two arguments for `disable_tablet_splitting`, addressing a previous condition where only one was required, thereby enhancing backup process reliability. {{<issue 8744>}}
* Introduces two unit tests to permit backup and restore across different catalog version modes, enhancing versatility and reducing potential code duplication. {{<issue 19474>}}
* Enables passing of username and password to the connect command akin to ysqlsh, permitting direct connection to the desired database/keyspace. {{<issue 14869>}}
* Introduces documentation for GFlags pertinent to the `bootstrap from closest peer` feature in the tserver flags page. {{<issue 18061>}}
* Corrects a nonfunctional link in the RBS GFlags description and adds documentation for the `bootstrap from closest peer` feature. {{<issue 18061>}}
* Reduces network requests when running ./yb_build.sh offline for a smoother rebuild process and adds helpful error messages for easier debugging. {{<issue 19476>}}
* Rectifies the issue where yugabyted crashes if yugabyted-ui binary doesn't exist, allowing the cluster to start with the UI disabled, similar to setting `ui=false` and alerts the user with a warning. {{<issue 16098>}}
* Resolves the odyssey build failure on Ubuntu 23.04 when compiling using ./yb_build.sh release gcc13 by addressing -Werror=address issue. {{<issue 19959>}}
* Adjusts previously hardcoded ports such as `master_rpc_port`, `tserver_webserver_port`, and `master_webserver_port` to dynamically accommodate custom configurations, solving connectivity issues in multi-region/zone cluster setups. {{<issue 15334>}}
* Ensures better visibility into local calls by tracking them and allowing `DumpRunningRpcs` API to fetch them; if rolled back, this functionality will turn unavailable. {{<issue 19697>}}
* Transitions primary build and packaging from Centos7 to AlmaLinux8, discontinuing support for Linux OS's with glibc less than 2.28 for future integrations, while preserving it for versions 2.20 and earlier. {{<issue 20173>}}

</details>
